[pytest]
# Python Test Configuration for PipesHub AI

# Test Discovery
python_files = test_*.py *_test.py
python_classes = Test* *Tests
python_functions = test_*
testpaths = tests

# Output Options
addopts =
    # Verbose output with detailed test info
    -v
    # Show local variables in tracebacks
    -l
    # Show summary of all test outcomes
    -ra
    # Capture output (use -s to disable for debugging)
    --capture=no
    # Show print statements immediately
    --tb=short
    # Strict markers - fail if unknown markers used
    --strict-markers
    # Show warnings
    --tb=short
    # Coverage options (uncomment when coverage is configured)
    # --cov=app
    # --cov-report=html:htmlcov
    # --cov-report=term-missing
    # --cov-report=xml
    # --cov-branch
    # Fail on first error for faster feedback (remove for CI)
    # -x
    # Run in parallel (uncomment when ready)
    # -n auto
    # Asyncio mode
    --asyncio-mode=auto

# Markers for categorizing tests
markers =
    unit: Unit tests that test individual components in isolation
    integration: Integration tests that test component interactions
    e2e: End-to-end tests that test full workflows
    slow: Tests that take significant time to run
    smoke: Quick smoke tests for basic functionality
    verification: Tests for the verification/hupyy feature
    connectors: Tests for connector functionality
    kafka: Tests involving Kafka
    database: Tests involving database operations
    external_api: Tests that call external APIs (use VCR)
    requires_credentials: Tests requiring external service credentials
    skip_ci: Tests to skip in CI environment
    wip: Work in progress tests

# Minimum Python version
minversion = 7.0

# Asyncio configuration
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Test timeouts (in seconds)
# Requires pytest-timeout plugin
# timeout = 300
# timeout_method = thread

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Ignore patterns
norecursedirs =
    .git
    .tox
    dist
    build
    *.egg
    __pycache__
    .mypy_cache
    .pytest_cache
    node_modules
    venv
    htmlcov

# Warning filters
filterwarnings =
    # Treat warnings as errors (uncomment for strict mode)
    # error
    # Ignore specific warnings
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # You can add specific warning filters like:
    # ignore::UserWarning:langchain

# Environment variables for testing
env =
    TESTING=true
    LOG_LEVEL=DEBUG

# Doctest configuration (if using doctests)
doctest_optionflags = NORMALIZE_WHITESPACE ELLIPSIS

# Paths to ignore
# Don't test the following directories
ignore =
    setup.py
    conftest.py
    */migrations/*
    */settings/*
